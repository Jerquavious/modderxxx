function x(t){window.enmity.plugins.registerPlugin(t)}const E=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const i=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage,window.enmity.modules.common.Toasts,window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const O=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme;const C=window.enmity.modules.common.Linking,B=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function H(t){return window.enmity.patcher.create(t)}var U="TrackEdit",A="1.0.0",V="Track edits/delete of other's messages",G=[{name:"mafu",id:"519760564755365888"}],$="#fff98a",j={name:U,version:A,description:V,authors:G,color:$};const{components:e}=window.enmity;e.Alert,e.Button,e.FlatList;const z=e.Image;e.ImageBackground,e.KeyboardAvoidingView,e.Modal,e.Pressable,e.RefreshControl;const Y=e.ScrollView;e.SectionList,e.StatusBar,e.StyleSheet,e.Switch;const S=e.Text;e.TextInput,e.TouchableHighlight,e.TouchableOpacity,e.TouchableWithoutFeedback,e.Touchable;const F=e.View;e.VirtualizedList,e.Form,e.FormArrow,e.FormCTA,e.FormCTAButton,e.FormCardSection,e.FormCheckbox,e.FormDivider,e.FormHint,e.FormIcon,e.FormInput,e.FormLabel,e.FormRadio;const c=e.FormRow,q=e.FormSection;e.FormSelect,e.FormSubLabel,e.FormSwitch,e.FormTernaryCheckBox,e.FormText,e.FormTextColors,e.FormTextSizes;function v(t){return window.enmity.assets.getIDByName(t)}const T={byProps:(...t)=>window.enmity.modules.filters.byProps(...t),byName:(t,n)=>window.enmity.modules.filters.byName(t,n),byTypeName:(t,n)=>window.enmity.modules.filters.byTypeName(t,n),byDisplayName:(t,n)=>window.enmity.modules.filters.byDisplayName(t,n)};function J(t,n){return window.enmity.modules.getModule(t,n)}function K(...t){return window.enmity.modules.bulk(...t)}function Q(...t){return window.enmity.modules.getByProps(...t)}window.enmity.modules.common;const W=v("img_account_sync_github_white"),X=v("Discord"),Z=v("img_account_sync_twitter_white"),ee=Q("acceptInviteAndTransitionToInviteChannel");var te=({settings:t})=>{const n=B.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:E.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:E.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:E.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return i.createElement(Y,null,i.createElement(F,{style:n.container},i.createElement(z,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),i.createElement(F,{style:n.title},i.createElement(S,{style:n.name},"TrackEdit"),i.createElement(S,{style:n.author},"by mafu"))),i.createElement(q,{title:"INFORMATION"},i.createElement(c,{label:"Follow me on Twitter",style:n.info,trailing:c.Arrow,leading:i.createElement(c.Icon,{source:Z}),onPress:()=>{C.openURL("https://twitter.com/m4fn3")}}),i.createElement(c,{label:"Visit my server for help",style:n.info,trailing:c.Arrow,leading:i.createElement(c.Icon,{source:X}),onPress:()=>{ee.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{O.pop()}})}}),i.createElement(c,{label:"Check Source on GitHub",style:n.info,trailing:c.Arrow,leading:i.createElement(c.Icon,{source:W}),onPress:()=>{C.openURL("https://github.com/m4fn3/TrackEdit")}})),i.createElement(S,{style:n.footer},`v${A}`))};const ne=J(t=>{var n,w,g;return(g=(w=(n=t._dispatcher)==null?void 0:n._actionHandlers)==null?void 0:w._dependencyGraph)==null?void 0:g.nodes}),b=ne._dispatcher._actionHandlers._dependencyGraph.nodes;function I(t){let n=Object.keys(b).filter(w=>b[w].name===t);if(n.length)return b[n[0]].actionHandler}const[oe,_,k,N]=K(T.byProps("_currentDispatchActionType","_subscriptions","_actionHandlers","_waitQueue"),T.byProps("getUser","getUsers"),T.byProps("getMessage","getMessages"),T.byProps("View")),{DCDChatManager:ie}=N.NativeModules,[D,me]=[I("MessageStore"),I("UserStore")],h=H("TrackEdit"),se={...j,onStart(){let t=0;const n=s=>s.content=="[TrackEdit]"&&s.type=="inlineCode",w=s=>s.content=="[TrackEdit]"&&s.type=="inlineCode",g=(s,o)=>({content:s,target:"usernameOnClick",context:{username:1,usernameOnClick:{linkColor:N.processColor(o)},medium:!0},type:"link"}),M=h.after(me,"CONNECTION_OPEN",(s,o,f)=>{var l;(l=_.getCurrentUser())!=null&&l.id&&(t=_.getCurrentUser().id),M()});h.before(ie,"updateRows",(s,o,f)=>{var l,a,u,d;const y=JSON.parse(o[1]);for(const m of y)if(((l=m.message)==null?void 0:l.content)&&Array.isArray((a=m.message)==null?void 0:a.content)){if((u=m.message)!=null&&u.content.slice(0,1).filter(r=>w(r)).length)m.message.edited="deleted",m.message.content=[g(m.message.content.slice(1).filter(r=>!n(r)),"#FF0000")];else if((d=m.message)!=null&&d.content.filter(r=>n(r)).length){let r=m.message.content.map((p,L)=>n(p)?L:void 0).filter(p=>p!=null),P=m.message.content.slice(r[r.length-1]+1),R=m.message.content.slice(0,r[r.length-1]).filter(p=>!n(p));m.message.content=[g(R,"#797979"),...P]}}o[1]=JSON.stringify(y)}),h.before(D,"MESSAGE_UPDATE",(s,o,f)=>{var l,a,u;if(o[0].ignore||!o[0].guildId||((a=(l=o[0].message)==null?void 0:l.author)==null?void 0:a.id)===t)return;const d=k.getMessage(o[0].message.channel_id,o[0].message.id);if(!d)return;let y=d.content?d.content.split(`
`).map(r=>r.replace(/^>>>/,"").replace(/^>/,"")).join(`
`):"",m=(u=o[0].message)!=null&&u.content?o[0].message.content:"";y!==m&&(o[0].message.content=`${y} \`[TrackEdit]\`
${m}`)}),h.instead(D,"MESSAGE_DELETE",(s,o,f)=>{var l;const a=k.getMessage(o[0].channelId,o[0].id);if(!a||((l=a.author)==null?void 0:l.id)===t){f.apply(s,o);return}let u=a.content?a.content:"";const d={type:"MESSAGE_UPDATE",guildId:o[0].guildId,message:{...a,content:`\`[TrackEdit]\`${u}`,guild_id:o[0].guildId},ignore:!0};oe.dispatch(d)})},onStop(){h.unpatchAll()},getSettingsPanel({settings:t}){return i.createElement(te,{settings:t})}};x(se);
